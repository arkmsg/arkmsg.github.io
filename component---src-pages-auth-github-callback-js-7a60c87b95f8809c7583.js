"use strict";(self.webpackChunkwhaleal_platform=self.webpackChunkwhaleal_platform||[]).push([[917],{3109:function(e,t,a){a.r(t),a.d(t,{default:function(){return n}});var o=a(6540),r=a(4794);function n(){return(0,o.useEffect)(()=>{(async()=>{const e=new URLSearchParams(window.location.search),t=e.get("code"),a=e.get("state"),o=e.get("error");if(o)return alert(`GitHub 登录失败: ${o}`),void(0,r.navigate)("/");if(a!==localStorage.getItem("github_oauth_state"))return alert("State 验证失败，请重试"),void(0,r.navigate)("/");if(t)try{const e={}.GATSBY_GITHUB_TOKEN_API||"/api/github/token",a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t})});if(!a.ok)throw new Error(`Token exchange failed: ${a.statusText}`);const o=await a.json();if(!o.token)throw new Error("No token received");{localStorage.setItem("github_token",o.token);const e=localStorage.getItem("github_oauth_redirect")||"/";localStorage.removeItem("github_oauth_redirect"),localStorage.removeItem("github_oauth_state"),(0,r.navigate)(e)}}catch(n){console.error("Error exchanging code:",n),n.message.includes("fetch")?alert("请配置后端 API 来处理 GitHub 登录。\n\n需要设置环境变量 GATSBY_GITHUB_TOKEN_API 指向你的后端 API 端点。"):alert("登录失败，请重试"),(0,r.navigate)("/")}else(0,r.navigate)("/")})()},[]),o.createElement("div",{style:{padding:"2rem",textAlign:"center"}},o.createElement("p",null,"正在处理 GitHub 登录..."))}}}]);
//# sourceMappingURL=component---src-pages-auth-github-callback-js-7a60c87b95f8809c7583.js.map