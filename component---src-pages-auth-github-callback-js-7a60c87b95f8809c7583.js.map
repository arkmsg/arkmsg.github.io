{"version":3,"file":"component---src-pages-auth-github-callback-js-7a60c87b95f8809c7583.js","mappings":"8LAMe,SAASA,IA6EtB,OA5EAC,EAAAA,EAAAA,WAAU,KACeC,WACrB,MAAMC,EAAY,IAAIC,gBAAgBC,OAAOC,SAASC,QAChDC,EAAOL,EAAUM,IAAI,QACrBC,EAAQP,EAAUM,IAAI,SACtBE,EAAQR,EAAUM,IAAI,SAG5B,GAAIE,EAGF,OAFAC,MAAM,gBAAgBD,UACtBE,EAAAA,EAAAA,UAAS,KAMX,GAAIH,IADeI,aAAaC,QAAQ,sBAItC,OAFAH,MAAM,uBACNC,EAAAA,EAAAA,UAAS,KAKX,GAAKL,EAKL,IAGE,MAAMQ,EAAcC,CAAAA,EAAYC,yBAA2B,oBAErDC,QAAiBC,MAAMJ,EAAa,CACxCK,OAAQ,OACRC,QAAS,CACP,eAAgB,oBAElBC,KAAMC,KAAKC,UAAU,CAAEjB,WAGzB,IAAKW,EAASO,GACZ,MAAM,IAAIC,MAAM,0BAA0BR,EAASS,cAGrD,MAAMC,QAAaV,EAASW,OAE5B,IAAID,EAAKE,MAYP,MAAM,IAAIJ,MAAM,qBAZF,CAEdb,aAAakB,QAAQ,eAAgBH,EAAKE,OAG1C,MAAME,EAAenB,aAAaC,QAAQ,0BAA4B,IACtED,aAAaoB,WAAW,yBACxBpB,aAAaoB,WAAW,uBAGxBrB,EAAAA,EAAAA,UAASoB,EACX,CAGF,CAAE,MAAOE,GACPC,QAAQzB,MAAM,yBAA0BwB,GAEpCA,EAAIE,QAAQC,SAAS,SACvB1B,MAAM,+EAENA,MAAM,aAERC,EAAAA,EAAAA,UAAS,IACX,MA9CEA,EAAAA,EAAAA,UAAS,MAiDb0B,IACC,IAGDC,EAAAA,cAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQC,UAAW,WACxCH,EAAAA,cAAA,SAAG,qBAGT,C","sources":["webpack://whaleal-platform/./src/pages/auth/github/callback.js"],"sourcesContent":["/**\n * GitHub OAuth 回调页面\n */\nimport React, { useEffect } from 'react';\nimport { navigate } from 'gatsby';\n\nexport default function GitHubCallback() {\n  useEffect(() => {\n    const handleCallback = async () => {\n      const urlParams = new URLSearchParams(window.location.search);\n      const code = urlParams.get('code');\n      const state = urlParams.get('state');\n      const error = urlParams.get('error');\n\n      // 检查错误\n      if (error) {\n        alert(`GitHub 登录失败: ${error}`);\n        navigate('/');\n        return;\n      }\n\n      // 验证 state\n      const savedState = localStorage.getItem('github_oauth_state');\n      if (state !== savedState) {\n        alert('State 验证失败，请重试');\n        navigate('/');\n        return;\n      }\n\n      // 如果没有 code，重定向到首页\n      if (!code) {\n        navigate('/');\n        return;\n      }\n\n      try {\n        // 交换 code 获取 token\n        // 需要后端 API 来处理 token 交换\n        const apiEndpoint = process.env.GATSBY_GITHUB_TOKEN_API || '/api/github/token';\n        \n        const response = await fetch(apiEndpoint, {\n          method: 'POST',\n          headers: { \n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({ code }),\n        });\n\n        if (!response.ok) {\n          throw new Error(`Token exchange failed: ${response.statusText}`);\n        }\n\n        const data = await response.json();\n        \n        if (data.token) {\n          // 保存 token\n          localStorage.setItem('github_token', data.token);\n          \n          // 获取原始页面路径\n          const redirectPath = localStorage.getItem('github_oauth_redirect') || '/';\n          localStorage.removeItem('github_oauth_redirect');\n          localStorage.removeItem('github_oauth_state');\n          \n          // 重定向回原页面\n          navigate(redirectPath);\n        } else {\n          throw new Error('No token received');\n        }\n      } catch (err) {\n        console.error('Error exchanging code:', err);\n        // 如果没有配置后端 API，提示用户\n        if (err.message.includes('fetch')) {\n          alert('请配置后端 API 来处理 GitHub 登录。\\n\\n需要设置环境变量 GATSBY_GITHUB_TOKEN_API 指向你的后端 API 端点。');\n        } else {\n          alert('登录失败，请重试');\n        }\n        navigate('/');\n      }\n    };\n\n    handleCallback();\n  }, []);\n\n  return (\n    <div style={{ padding: '2rem', textAlign: 'center' }}>\n      <p>正在处理 GitHub 登录...</p>\n    </div>\n  );\n}\n\n"],"names":["GitHubCallback","useEffect","async","urlParams","URLSearchParams","window","location","search","code","get","state","error","alert","navigate","localStorage","getItem","apiEndpoint","process","GATSBY_GITHUB_TOKEN_API","response","fetch","method","headers","body","JSON","stringify","ok","Error","statusText","data","json","token","setItem","redirectPath","removeItem","err","console","message","includes","handleCallback","React","style","padding","textAlign"],"sourceRoot":""}